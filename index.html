<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>阳光下的程序猿</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="keywords" content="PHP,iOS,Android,Html5,程序猿,工程师">
  <meta name="baidu-site-verification" content="yhU5S8HXW0" />
  <meta name="description" content="想成为一个小小的小小的小小的全栈工程师">
<meta property="og:type" content="website">
<meta property="og:title" content="阳光下的程序猿">
<meta property="og:url" content="www.3vcolor.com/index.html">
<meta property="og:site_name" content="阳光下的程序猿">
<meta property="og:description" content="想成为一个小小的小小的小小的全栈工程师">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="阳光下的程序猿">
<meta name="twitter:description" content="想成为一个小小的小小的小小的全栈工程师">
  
    <link rel="alternative" href="/atom.xml" title="阳光下的程序猿" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://7xo6u7.com1.z0.glb.clouddn.com/avater.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">三维色</a></h1>
		</hgroup>

		
		<p class="header-subtitle">想改变世界的小小小小小葫芦</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>標籤</li>
						
						
						<li>關於</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
							<li><a href="/tags/iOS">iOS</a></li>
				        
							<li><a href="/tags/php">php</a></li>
				        
							<li><a href="/tags/android">android</a></li>
				        
							<li><a href="/tags/c">c</a></li>
				        
							<li><a href="/tags/bug">bug</a></li>
				        
							<li><a href="/tags/随想">随想</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/xiaozhangfei" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/muatong" title="weibo">weibo</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/bug/" style="font-size: 15px;">bug</a> <a href="/tags/c/" style="font-size: 15px;">c</a> <a href="/tags/iOS/" style="font-size: 20px;">iOS</a> <a href="/tags/php/" style="font-size: 15px;">php</a> <a href="/tags/随想/" style="font-size: 10px;">随想</a>
					</div>
				</section>
				
				
				

				
				
				<section class="switch-part switch-part3">
				
					<div id="js-aboutme">无心得到的一切放开也未染尘 随心欣赏的景致最吸引 谁想过 清风踏绿草未无痕 留下无心的美感 谁想过 一生像雾水逐闲云 原是无心中发生</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">三维色</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="http://7xo6u7.com1.z0.glb.clouddn.com/avater.jpg" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">三维色</h1>
			</hgroup>
			
			<p class="header-subtitle">想改变世界的小小小小小葫芦</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
					<li><a href="/tags/iOS">iOS</a></li>
		        
					<li><a href="/tags/php">php</a></li>
		        
					<li><a href="/tags/android">android</a></li>
		        
					<li><a href="/tags/c">c</a></li>
		        
					<li><a href="/tags/bug">bug</a></li>
		        
					<li><a href="/tags/随想">随想</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/xiaozhangfei" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/muatong" title="weibo">weibo</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
  
    <article id="post-runtime" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/07/runtime/" class="article-date">
  	<time datetime="2016-07-26T08:20:07.000Z" itemprop="datePublished">2016-07-26</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/07/runtime/">runtime</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="u8F6C_u8F7D"><a href="#u8F6C_u8F7D" class="headerlink" title="转载"></a>转载</h3><ul>
<li><a href="http://blog.csdn.net/lizhongfu2013/article/details/9496705" target="_blank" rel="external">来源：IOS高级开发～Runtime（一）</a></li>
<li><a href="http://blog.csdn.net/zfpp25_/article/details/9497187" target="_blank" rel="external">来源：IOS高级开发～Runtime（二）</a></li>
<li><a href="http://blog.csdn.net/zfpp25_/article/details/9497721" target="_blank" rel="external">来源：IOS高级开发～Runtime（三）</a></li>
<li><a href="http://blog.csdn.net/zfpp25_/article/details/9498233" target="_blank" rel="external">来源：IOS高级开发～Runtime（四）</a></li>
</ul>
<p>引入头文件 #include<objc runtime.h=""></objc></p>
<ol>
<li>对象拷贝<br>id object_copy(id obj, size_t size)</li>
</ol>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">object_copy(obj,<span class="keyword">sizeof</span>(obj));</span><br></pre></td></tr></table></figure>
<ol>
<li>对象释放<br>id object_dispose(id obj)</li>
</ol>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">object_dispose(obj);</span><br></pre></td></tr></table></figure>
<ol>
<li>更改对象的类／获取对象的类<br>Class object_setClass(id obj, Class cls)<br>Class object_getClass(id obj)</li>
</ol>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//修改对象</span></span><br><span class="line">object_setClass(obj, obj1);</span><br></pre></td></tr></table></figure>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取对象</span></span><br><span class="line">Class obj2 = object_getClass(obj);</span><br></pre></td></tr></table></figure>
<ol>
<li>获取对象的类名<br>constchar *object_getClassName(id obj)</li>
</ol>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *className = [<span class="built_in">NSStringstringWithCString</span>:object_getClassName(obj) encoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br></pre></td></tr></table></figure>
<ol>
<li>给一个类添加方法<br>BOOL class_addMethod(Class cls,SEL name,IMP imp,    const char *types)</li>
</ol>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line">一个参数</span><br><span class="line">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> cfunction(<span class="keyword">id</span> <span class="keyword">self</span>, SEL _cmd, <span class="built_in">NSString</span> *str) &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, str);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">10</span>;<span class="comment">//随便返回个值</span></span><br><span class="line">&#125;</span><br><span class="line">    - (<span class="keyword">void</span>)oneParam &#123;</span><br><span class="line">    TestClass *instance = [[TestClass alloc] init];</span><br><span class="line">    <span class="comment">//方法添加</span></span><br><span class="line">    class_addMethod([TestClass class],<span class="keyword">@selector</span>(ocMethod:), (IMP)cfunction,<span class="string">"i@:@"</span>);</span><br><span class="line">    <span class="keyword">if</span> ([instance respondsToSelector:<span class="keyword">@selector</span>(ocMethod:)]) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"Yes, instance respondsToSelector:@selector(ocMethod:)"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"Sorry"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> a = (<span class="keyword">int</span>)[instance ocMethod:<span class="string">@"我是一个OC的method，C函数实现"</span>];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"a:%d"</span>, a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/*</span><br><span class="line">  *两个参数</span><br><span class="line">  */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> cfunctionA(<span class="keyword">id</span> <span class="keyword">self</span>, SEL _cmd, <span class="built_in">NSString</span> *str, <span class="built_in">NSString</span> *str1) &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@-%@"</span>, str, str1);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">20</span>;<span class="comment">//随便返回个值</span></span><br><span class="line">&#125;</span><br><span class="line">    - (<span class="keyword">void</span>)twoParam &#123;</span><br><span class="line">    TestClass *instance = [[TestClass alloc] init];</span><br><span class="line">    class_addMethod([TestClass class],<span class="keyword">@selector</span>(ocMethodA::), (IMP)cfunctionA, <span class="string">"i@:@@"</span>);</span><br><span class="line">    <span class="keyword">if</span> ([instance respondsToSelector:<span class="keyword">@selector</span>(ocMethodA::)]) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"Yes, instance respondsToSelector:@selector(ocMethodA::)"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"Sorry"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> a = (<span class="keyword">int</span>)[instance ocMethodA:<span class="string">@"我是一个OC的method，C函数实现"</span> :<span class="string">@"-----我是第二个参数"</span>];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"a:%d"</span>, a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Obj-C的方法（method）就是一个至少需要两个参数（self，_cmd）的C函数<br>  IMP有点类似函数指针，指向具体的Method实现</p>
<p>向一个类动态添加方法<br>    BOOL class_addMethod(Class cls, SEL name, IMP imp, const char *types)<br>    参数说明：<br>    cls：被添加方法的类<br>    name：可以理解为方法名<br>    imp：实现这个方法的函数<br>    types：一个定义该函数返回值类型和参数类型的字符串</p>
<p>class_addMethod([TestClass class], @selector(ocMethod:), (IMP)testFunc, “i@:@”);<br>    其中types参数为”i@:@“，按顺序分别表示：<br>    i：返回值类型int，若是v则表示void<br>    @：参数id(self)<br>    :：SEL(_cmd)<br>    @：id(str)</p>
</blockquote>
<ol>
<li>获取一个类的所有方法<br> u_int count;<br> Method* methods= class_copyMethodList([UIViewController class], &amp;count);</li>
</ol>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>) getClassAllMethod</span><br><span class="line">&#123;</span><br><span class="line">    u_int count;</span><br><span class="line">    Method* methods= class_copyMethodList([<span class="built_in">UIViewController</span> class], &amp;count);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count ; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        SEL name = method_getName(methods[i]);</span><br><span class="line">        <span class="built_in">NSString</span> *strName = [<span class="built_in">NSString</span> stringWithCString:sel_getName(name) encoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,strName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>获取一个类的所有属性<br> objc_property_t *properties = class_copyPropertyList([UIViewControllerclass], &amp;count);</li>
</ol>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>) propertyNameList</span><br><span class="line">&#123;</span><br><span class="line">    u_int count;</span><br><span class="line">    objc_property_t *properties=class_copyPropertyList([<span class="built_in">UIViewController</span> class], &amp;count);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count ; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">char</span>* propertyName =property_getName(properties[i]);</span><br><span class="line">        <span class="built_in">NSString</span> *strName = [<span class="built_in">NSString</span> stringWithCString:propertyName encoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,strName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>获取／设置类的属性变量<br> object_getInstanceVariable(self,”myFloat”, (void<em>)&amp;myFloatValue);<br> object_setInstanceVariable(self,”myFloat”, </em>(float**)addr);</li>
</ol>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取全局变量的值   （myFloat 为类的一个属性变量）</span></span><br><span class="line">- (<span class="keyword">void</span>) getInstanceVar &#123;</span><br><span class="line">    <span class="keyword">float</span> myFloatValue;</span><br><span class="line">    object_getInstanceVariable(<span class="keyword">self</span>,<span class="string">"myFloat"</span>, (<span class="keyword">void</span>*)&amp;myFloatValue);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%f"</span>, myFloatValue);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//设置全局变量的值</span></span><br><span class="line">- (<span class="keyword">void</span>) setInstanceVar &#123;</span><br><span class="line">    <span class="keyword">float</span> newValue = <span class="number">10.00</span>f;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> addr = (unsignedint)&amp;newValue;</span><br><span class="line">    object_setInstanceVariable(<span class="keyword">self</span>,<span class="string">"myFloat"</span>, *(<span class="keyword">float</span>**)addr);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%f"</span>, myFloat);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>判断类的某个属性的类型<br> Ivar var = class_getInstanceVariable(object_getClass(obj),”varTest1”);</li>
</ol>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>) getVarType &#123;</span><br><span class="line">    ClassCustomClass *obj = [ClassCustomClass new];</span><br><span class="line">    Ivar var = class_getInstanceVariable(object_getClass(obj),<span class="string">"varTest1"</span>);</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* typeEncoding =ivar_getTypeEncoding(var);</span><br><span class="line">    <span class="built_in">NSString</span> *stringType =  [<span class="built_in">NSString</span> stringWithCString:typeEncoding encoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> ([stringType hasPrefix:<span class="string">@"@"</span>]) &#123;</span><br><span class="line">        <span class="comment">// handle class case</span></span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"handle class case"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([stringTypehasPrefix:<span class="string">@"i"</span>]) &#123;</span><br><span class="line">        <span class="comment">// handle int case</span></span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"handle int case"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([stringTypehasPrefix:<span class="string">@"f"</span>]) &#123;</span><br><span class="line">        <span class="comment">// handle float case</span></span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"handle float case"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>通过属性的值来获取其属性的名字（反射机制）<br> Ivar * ivars = class_copyIvarList([ClassCustomClassclass], &amp;numIvars);</li>
</ol>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSString</span> *)nameOfInstance:(<span class="keyword">id</span>)instance</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> numIvars =<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">NSString</span> *key = <span class="literal">nil</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Describes the instance variables declared by a class. </span></span><br><span class="line">    Ivar * ivars = class_copyIvarList([ClassCustomClass class], &amp;numIvars);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; numIvars; i++) &#123;</span><br><span class="line">        Ivar thisIvar = ivars[i];</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">char</span> *type = ivar_getTypeEncoding(thisIvar);</span><br><span class="line">        <span class="built_in">NSString</span> *stringType =  [<span class="built_in">NSString</span> stringWithCString:type encoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//不是class就跳过</span></span><br><span class="line">        <span class="keyword">if</span> (![stringType hasPrefix:<span class="string">@"@"</span>]) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//Reads the value of an instance variable in an object.</span></span><br><span class="line">        <span class="comment">//object_getIvar这个方法中，当遇到非objective-c对象时，并直接crash</span></span><br><span class="line">        <span class="keyword">if</span> ((object_getIvar(allobj, thisIvar) == instance)) &#123;</span><br><span class="line">            <span class="comment">// Returns the name of an instance variable.</span></span><br><span class="line">            key = [<span class="built_in">NSString</span> stringWithUTF8String:ivar_getName(thisIvar)];</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    free(ivars);<span class="comment">//需要释放</span></span><br><span class="line">    <span class="keyword">return</span> key;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>系统类的方法实现部分替换<br>method_exchangeImplementations(m1, m2);</li>
</ol>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Method m1 = class_getInstanceMethod([<span class="built_in">NSString</span> class],<span class="keyword">@selector</span>(lowercaseString));</span><br><span class="line">Method m2 = class_getInstanceMethod([<span class="built_in">NSString</span> class],<span class="keyword">@selector</span>(uppercaseString));</span><br><span class="line">method_exchangeImplementations(m1, m2);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [<span class="string">@"sssAAAAss"</span>lowercaseString]);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [<span class="string">@"sssAAAAss"</span>uppercaseString]);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span><br><span class="line">*   2013-07-26 16:33:22.776 HighOC[7104:c07] SSSAAAASS</span><br><span class="line">*   2013-07-26 16:33:22.778 HighOC[7104:c07] sssaaaass</span><br><span class="line">*/</span></span><br></pre></td></tr></table></figure>
<ol>
<li>自定义类的方法实现部分替换<br>method_setImplementation(m1, originalImp)</li>
</ol>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>) justLog1 &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"justLog1"</span>);</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>) justLog2 &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"justLog2"</span>);</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>) methodSetImplementation &#123;</span><br><span class="line">    Method method = class_getInstanceMethod([ClassMethodViewCtr class],<span class="keyword">@selector</span>(justLog1));</span><br><span class="line">    IMP originalImp = method_getImplementation(method);</span><br><span class="line">    Method m1 = class_getInstanceMethod([ClassMethodViewCtr class],<span class="keyword">@selector</span>(justLog2));</span><br><span class="line">    method_setImplementation(m1, originalImp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>覆盖系统方法</li>
</ol>
<ol>
<li>自动序列化</li>
</ol>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#import <span class="title">"NSObject+AutoEncodeDecode.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">NSObject</span> (<span class="title">AutoEncodeDecode</span>)</span></span><br><span class="line">- (<span class="keyword">void</span>)encodeWithCoder:(<span class="built_in">NSCoder</span> *)encoder &#123;</span><br><span class="line">    Class cls = [<span class="keyword">self</span> class];</span><br><span class="line">    <span class="keyword">while</span> (cls != [<span class="built_in">NSObject</span> class]) &#123;</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">int</span> numberOfIvars =<span class="number">0</span>;</span><br><span class="line">        Ivar *ivars = class_copyIvarList(cls, &amp;numberOfIvars);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">const</span> Ivar* p = ivars; p &lt; ivars + numberOfIvars; p++)&#123;</span><br><span class="line">            Ivar <span class="keyword">const</span> ivar = *p;</span><br><span class="line">            <span class="keyword">const</span> <span class="keyword">char</span> *type = ivar_getTypeEncoding(ivar);</span><br><span class="line">            <span class="built_in">NSString</span> *key = [<span class="built_in">NSString</span> stringWithUTF8String:ivar_getName(ivar)];</span><br><span class="line">            <span class="keyword">id</span> value = [<span class="keyword">self</span> valueForKey:key];</span><br><span class="line">            <span class="keyword">if</span> (value) &#123;</span><br><span class="line">                <span class="keyword">switch</span> (type[<span class="number">0</span>]) &#123;</span><br><span class="line">                    <span class="keyword">case</span> _C_STRUCT_B: &#123;</span><br><span class="line">                        <span class="built_in">NSUInteger</span> ivarSize =<span class="number">0</span>;</span><br><span class="line">                        <span class="built_in">NSUInteger</span> ivarAlignment =<span class="number">0</span>;</span><br><span class="line">                        <span class="built_in">NSGetSizeAndAlignment</span>(type, &amp;ivarSize, &amp;ivarAlignment);</span><br><span class="line">                        <span class="built_in">NSData</span> *data = [<span class="built_in">NSDatadataWithBytes</span>:(constchar *)<span class="keyword">self</span> + ivar_getOffset(ivar)</span><br><span class="line">                                                      length:ivarSize];</span><br><span class="line">                        [encoder encodeObject:data forKey:key];</span><br><span class="line">                    &#125;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">default</span>:</span><br><span class="line">                        [encoder encodeObject:value</span><br><span class="line">                                       forKey:key];</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        free(ivars);</span><br><span class="line">        cls = class_getSuperclass(cls);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>)initWithCoder:(<span class="built_in">NSCoder</span> *)decoder &#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">self</span> init];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</span><br><span class="line">        Class cls = [<span class="keyword">self</span> class];</span><br><span class="line">        <span class="keyword">while</span> (cls != [<span class="built_in">NSObject</span> class]) &#123;</span><br><span class="line">            <span class="keyword">unsigned</span> <span class="keyword">int</span> numberOfIvars =<span class="number">0</span>;</span><br><span class="line">            Ivar* ivars = class_copyIvarList(cls, &amp;numberOfIvars);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span>(constIvar *p = ivars; p &lt; ivars + numberOfIvars; p++)&#123;</span><br><span class="line">                Ivar <span class="keyword">const</span> ivar = *p;</span><br><span class="line">                <span class="keyword">const</span> <span class="keyword">char</span> *type = ivar_getTypeEncoding(ivar);</span><br><span class="line">                <span class="built_in">NSString</span> *key = [<span class="built_in">NSString</span> stringWithUTF8String:ivar_getName(ivar)];</span><br><span class="line">                <span class="keyword">id</span> value = [decoder decodeObjectForKey:key];</span><br><span class="line">                <span class="keyword">if</span> (value) &#123;</span><br><span class="line">                    <span class="keyword">switch</span> (type[<span class="number">0</span>]) &#123;</span><br><span class="line">                        <span class="keyword">case</span> _C_STRUCT_B: &#123;</span><br><span class="line">                            <span class="built_in">NSUInteger</span> ivarSize =<span class="number">0</span>;</span><br><span class="line">                            <span class="built_in">NSUInteger</span> ivarAlignment =<span class="number">0</span>;</span><br><span class="line">                            <span class="built_in">NSGetSizeAndAlignment</span>(type, &amp;ivarSize, &amp;ivarAlignment);</span><br><span class="line">                            <span class="built_in">NSData</span> *data = [decoder decodeObjectForKey:key];</span><br><span class="line">                            <span class="keyword">char</span> *sourceIvarLocation = (<span class="keyword">char</span>*)<span class="keyword">self</span> + ivar_getOffset(ivar);</span><br><span class="line">                            [data getBytes:sourceIvarLocation length:ivarSize];</span><br><span class="line">                        &#125;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        <span class="keyword">default</span>:</span><br><span class="line">                            [<span class="keyword">self</span> setValue:[decoder decodeObjectForKey:key]</span><br><span class="line">                                    forKey:key];</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            free(ivars);</span><br><span class="line">            cls = class_getSuperclass(cls);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>用c代替oc</li>
</ol>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#import <span class="title">&lt;objc/runtime.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#import <span class="title">&lt;objc/message.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#import <span class="title">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">int</span> <span class="built_in">UIApplicationMain</span> (<span class="keyword">int</span> argc,<span class="keyword">char</span> *argv[],<span class="keyword">void</span> *principalClassName,<span class="keyword">void</span> *delegateClassName);</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> Rect &#123;</span><br><span class="line">  <span class="keyword">float</span> x;</span><br><span class="line">  <span class="keyword">float</span> y;</span><br><span class="line">  <span class="keyword">float</span> width;</span><br><span class="line">  <span class="keyword">float</span> height;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> Rect Rect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> *navController;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> numberOfRows = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> tableView_numberOfRowsInSection(<span class="keyword">void</span> *receiver,structobjc_selector *selector, <span class="keyword">void</span> *tblview,<span class="keyword">int</span> section) &#123;</span><br><span class="line">  returnnumberOfRows;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> *tableView_cellForRowAtIndexPath(<span class="keyword">void</span> *receiver,structobjc_selector *selector, <span class="keyword">void</span> *tblview,<span class="keyword">void</span> *indexPath) &#123;</span><br><span class="line">  Class TableViewCell = (Class)objc_getClass(<span class="string">"UITableViewCell"</span>);</span><br><span class="line">  <span class="keyword">void</span> *cell = class_createInstance(TableViewCell,<span class="number">0</span>);</span><br><span class="line">  objc_msgSend(cell, sel_registerName(<span class="string">"init"</span>));</span><br><span class="line">  <span class="keyword">char</span> buffer[<span class="number">7</span>];</span><br><span class="line">  <span class="keyword">int</span> row = (<span class="keyword">int</span>) objc_msgSend(indexPath, sel_registerName(<span class="string">"row"</span>));</span><br><span class="line">  sprintf (buffer, <span class="string">"Row %d"</span>, row);</span><br><span class="line">  <span class="keyword">void</span> *label =objc_msgSend(objc_getClass(<span class="string">"NSString"</span>),sel_registerName(<span class="string">"stringWithUTF8String:"</span>),buffer);</span><br><span class="line">  objc_msgSend(cell, sel_registerName(<span class="string">"setText:"</span>),label);</span><br><span class="line">  <span class="keyword">return</span> cell;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> tableView_didSelectRowAtIndexPath(<span class="keyword">void</span> *receiver,structobjc_selector *selector, <span class="keyword">void</span> *tblview,<span class="keyword">void</span> *indexPath) &#123;</span><br><span class="line">  Class ViewController = (Class)objc_getClass(<span class="string">"UIViewController"</span>);</span><br><span class="line">  <span class="keyword">void</span> * vc = class_createInstance(ViewController,<span class="number">0</span>);</span><br><span class="line">  objc_msgSend(vc, sel_registerName(<span class="string">"init"</span>));</span><br><span class="line">  <span class="keyword">char</span> buffer[<span class="number">8</span>];</span><br><span class="line">  <span class="keyword">int</span> row = (<span class="keyword">int</span>) objc_msgSend(indexPath, sel_registerName(<span class="string">"row"</span>));</span><br><span class="line">  sprintf (buffer, <span class="string">"Item %d"</span>, row);</span><br><span class="line">  <span class="keyword">void</span> *label =objc_msgSend(objc_getClass(<span class="string">"NSString"</span>),sel_registerName(<span class="string">"stringWithUTF8String:"</span>),buffer);</span><br><span class="line">  objc_msgSend(vc, sel_registerName(<span class="string">"setTitle:"</span>),label);</span><br><span class="line">  objc_msgSend(navController,sel_registerName(<span class="string">"pushViewController:animated:"</span>),vc,<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> *createDataSource() &#123;</span><br><span class="line">  Class superclass = (Class)objc_getClass(<span class="string">"NSObject"</span>);</span><br><span class="line">  Class DataSource = objc_allocateClassPair(superclass,<span class="string">"DataSource"</span>,<span class="number">0</span>);</span><br><span class="line">  class_addMethod(DataSource,sel_registerName(<span class="string">"tableView:numberOfRowsInSection:"</span>), (<span class="keyword">void</span>(*))tableView_numberOfRowsInSection,<span class="literal">nil</span>);</span><br><span class="line">  class_addMethod(DataSource,sel_registerName(<span class="string">"tableView:cellForRowAtIndexPath:"</span>), (<span class="keyword">void</span>(*))tableView_cellForRowAtIndexPath,<span class="literal">nil</span>);</span><br><span class="line">  objc_registerClassPair(DataSource);</span><br><span class="line">  returnclass_createInstance(DataSource,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> *createDelegate() &#123;</span><br><span class="line">  Class superclass = (Class)objc_getClass(<span class="string">"NSObject"</span>);</span><br><span class="line">  Class DataSource = objc_allocateClassPair(superclass,<span class="string">"Delegate"</span>,<span class="number">0</span>);</span><br><span class="line">  class_addMethod(DataSource,sel_registerName(<span class="string">"tableView:didSelectRowAtIndexPath:"</span>), (<span class="keyword">void</span>(*))tableView_didSelectRowAtIndexPath,<span class="literal">nil</span>);</span><br><span class="line">  objc_registerClassPair(DataSource);</span><br><span class="line">  returnclass_createInstance(DataSource,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> applicationdidFinishLaunching(<span class="keyword">void</span> *receiver,structobjc_selector *selector, <span class="keyword">void</span> *application) &#123;</span><br><span class="line">  Class windowClass = (Class)objc_getClass(<span class="string">"UIWindow"</span>);</span><br><span class="line">  <span class="keyword">void</span> * windowInstance = class_createInstance(windowClass, <span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">  objc_msgSend(windowInstance, sel_registerName(<span class="string">"initWithFrame:"</span>),(Rect)&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">320</span>,<span class="number">480</span>&#125;);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//Make Key and Visiable</span></span><br><span class="line">  objc_msgSend(windowInstance,sel_registerName(<span class="string">"makeKeyAndVisible"</span>));</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Create Table View</span></span><br><span class="line">  Class TableViewController = (Class)objc_getClass(<span class="string">"UITableViewController"</span>);</span><br><span class="line">  <span class="keyword">void</span> *tableViewController = class_createInstance(TableViewController, <span class="number">0</span>);</span><br><span class="line">  objc_msgSend(tableViewController, sel_registerName(<span class="string">"init"</span>));</span><br><span class="line">  <span class="keyword">void</span> *tableView = objc_msgSend(tableViewController,sel_registerName(<span class="string">"tableView"</span>));</span><br><span class="line">  objc_msgSend(tableView, sel_registerName(<span class="string">"setDataSource:"</span>),createDataSource());</span><br><span class="line">  objc_msgSend(tableView, sel_registerName(<span class="string">"setDelegate:"</span>),createDelegate());</span><br><span class="line"> </span><br><span class="line">  Class NavController = (Class)objc_getClass(<span class="string">"UINavigationController"</span>);</span><br><span class="line">  navController = class_createInstance(NavController,<span class="number">0</span>);</span><br><span class="line">  objc_msgSend(navController,sel_registerName(<span class="string">"initWithRootViewController:"</span>),tableViewController);</span><br><span class="line">  <span class="keyword">void</span> *view =objc_msgSend(navController,sel_registerName(<span class="string">"view"</span>));</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//Add Table View To Window</span></span><br><span class="line">  objc_msgSend(windowInstance, sel_registerName(<span class="string">"addSubview:"</span>),view);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Create an class named "AppDelegate", and return it's name as an instance of class NSString</span></span><br><span class="line"><span class="keyword">void</span> *createAppDelegate() &#123;</span><br><span class="line">  Class mySubclass = objc_allocateClassPair((Class)objc_getClass(<span class="string">"NSObject"</span>),<span class="string">"AppDelegate"</span>,<span class="number">0</span>);</span><br><span class="line">  structobjc_selector *selName =sel_registerName(<span class="string">"application:didFinishLaunchingWithOptions:"</span>);</span><br><span class="line">  class_addMethod(mySubclass, selName, (<span class="keyword">void</span>(*))applicationdidFinishLaunching,<span class="literal">nil</span>);</span><br><span class="line">  objc_registerClassPair(mySubclass);</span><br><span class="line">  returnobjc_msgSend(objc_getClass(<span class="string">"NSString"</span>),sel_registerName(<span class="string">"stringWithUTF8String:"</span>),<span class="string">"AppDelegate"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[]) &#123;</span><br><span class="line">  <span class="keyword">return</span><span class="built_in">UIApplicationMain</span>(argc, argv,<span class="number">0</span>,createAppDelegate());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/iOS-runtime/">iOS runtime</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-postMan使用" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/07/postMan使用/" class="article-date">
  	<time datetime="2016-07-26T08:15:28.000Z" itemprop="datePublished">2016-07-26</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/07/postMan使用/">Postman</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>Postman是一款功能强大的网页调试与发送网页HTTP请求的Chrome插件。</p>
</blockquote>
<p>在进行web开发或者app开发时，经常要测试web接口，而Postman就是一款很好用的web模拟访问工具。</p>
<p>Postman有插件和桌面端两种。可以再谷歌浏览器应用商店下载。</p>
<p><img src="http://7xo6u7.com1.z0.glb.clouddn.com/oc/postman.jpg" alt="postman"></p>
<p>在接口测试中，可以选择get/post/delete等多种请求方式</p>
<p><img src="http://7xo6u7.com1.z0.glb.clouddn.com/oc/postman1.jpg" alt="postman请求方式选择"></p>
<h5 id="postman_u6DFB_u52A0collection"><a href="#postman_u6DFB_u52A0collection" class="headerlink" title="postman添加collection"></a>postman添加collection</h5><p>在使用中，开发人员可以打出一个collection接口包，发给其他人员，比word式的接口文档方便很多。</p>
<ol>
<li>左侧添加 新的collection文件夹<br>也可以新建子文件夹</li>
<li>点击右侧 + 号，添加一个链接页面，填写请求方式、header、body格式、Auth Type</li>
<li>点击 <strong>Save</strong> 右侧下拉框， 选择 <strong>Save as…</strong> ,填写<ul>
<li>Request Name 请求名称 e.g. 登录</li>
<li>Request description 请求描述，支持markdown, e.g. moblie 手机号 …</li>
<li>Save to existing collection 保存到哪个文件夹</li>
</ul>
</li>
<li>点击save按钮</li>
</ol>
<p>此时一个collection已经完成</p>
<p>分享：可以作为文件内部分享，也可以分享出一个链接，其他人拿到之后使用postman export即可。</p>
<p>分享出链接：</p>
<ol>
<li>注册登录</li>
<li>点击share，会弹出一个链接 <a href="https://www.getpostman.com/collections/a42bf79c******cd" target="_blank" rel="external">https://www.getpostman.com/collections/a42bf79c******cd</a> ， 此链接即为分享链接。</li>
</ol>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/php/">php</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/Postman/">Postman</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-杭电acm 1002" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/04/杭电acm 1002/" class="article-date">
  	<time datetime="2016-04-27T01:06:29.000Z" itemprop="datePublished">2016-04-27</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/杭电acm 1002/">杭电acm 1002</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="u676D_u7535acm_1001"><a href="#u676D_u7535acm_1001" class="headerlink" title="杭电acm 1001"></a>杭电acm 1001</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include "string.h"</span></span><br><span class="line">int TotalNum = <span class="number">2000</span>;</span><br><span class="line"></span><br><span class="line">// 反转字符串</span><br><span class="line">char* turnStr(char * s, int len) &#123;</span><br><span class="line"></span><br><span class="line">    char tmp;</span><br><span class="line">    <span class="keyword">for</span> (int i = <span class="number">0</span>; i &lt; len / <span class="number">2</span>; i ++) &#123;</span><br><span class="line">        tmp = s[i];</span><br><span class="line">        s[i] = s[len - <span class="number">1</span> - i];</span><br><span class="line">        s[len - <span class="number">1</span> - i] = tmp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> s;</span><br><span class="line">&#125;</span><br><span class="line">// 计算大整数</span><br><span class="line">void aAddb(int n)</span><br><span class="line">&#123;</span><br><span class="line">    char a[TotalNum], b[TotalNum];</span><br><span class="line">    char sum[TotalNum];</span><br><span class="line">    scanf(<span class="string">"%s%s"</span>, a, b);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Case %d:\n"</span>,n + <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%s + %s = "</span>, a, b);</span><br><span class="line">    char *s = turnStr(a, (int)strlen(a));</span><br><span class="line">    char *t = turnStr(b, (int)strlen(b));</span><br><span class="line"></span><br><span class="line">    int k = <span class="number">0</span>, c = <span class="number">0</span>, i = <span class="number">0</span>;</span><br><span class="line">    memset(sum, <span class="number">0</span>, TotalNum);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; strlen(s) &amp;&amp; i &lt; strlen(t) ; i ++) &#123;</span><br><span class="line">        c = s[i] + t[i] - <span class="number">2</span> * <span class="string">'0'</span> + k;</span><br><span class="line">        sum[i] = c % <span class="number">10</span> + <span class="string">'0'</span>;</span><br><span class="line">        k = c / <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (i == strlen(s) &amp;&amp; i == strlen(t)) &#123; //同等长度</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i == strlen(s)) &#123; // t较长</span><br><span class="line">        <span class="keyword">for</span> (; i &lt; strlen(t); i ++) &#123;</span><br><span class="line">            c = t[i] - <span class="string">'0'</span> + k;</span><br><span class="line">            sum[i] = c % <span class="number">10</span> + <span class="string">'0'</span>;</span><br><span class="line">            k = c / <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i == strlen(t)) &#123; // s较长</span><br><span class="line">        <span class="keyword">for</span> (; i &lt; strlen(s); i ++) &#123;</span><br><span class="line">            c = s[i] - <span class="string">'0'</span> + k;</span><br><span class="line">            sum[i] = c % <span class="number">10</span> + <span class="string">'0'</span>;</span><br><span class="line">            k = c / <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (k != <span class="number">0</span>) &#123;</span><br><span class="line">        sum[i] = k % <span class="number">10</span> + <span class="string">'0'</span>;</span><br><span class="line">        <span class="keyword">if</span> (k / <span class="number">10</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            sum[i + <span class="number">1</span>] = k / <span class="number">10</span> + <span class="string">'0'</span>;</span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%s\n"</span>, turnStr(sum, (int)strlen(sum)));</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(int argc, const char * argv[]) &#123;</span><br><span class="line"></span><br><span class="line">    int n = <span class="number">0</span>;</span><br><span class="line">    //<span class="built_in">printf</span>(<span class="string">"total case:"</span>);</span><br><span class="line">    scanf(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line">    <span class="keyword">for</span> (int i = <span class="number">0</span>; i &lt; n; i ++) &#123;</span><br><span class="line">        aAddb(i);</span><br><span class="line">        <span class="keyword">if</span> (i != n - <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="http://acm.hdu.edu.cn/showproblem.php?pid=1002" target="_blank" rel="external">杭电acm 1002</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/c/">c</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/c-杭电1002/">c 杭电1002</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-友盟统计崩溃跟踪" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/04/友盟统计崩溃跟踪/" class="article-date">
  	<time datetime="2016-04-11T08:19:47.000Z" itemprop="datePublished">2016-04-11</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/友盟统计崩溃跟踪/">友盟统计崩溃跟踪</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>使用友盟统计经常会出现 <strong>Application received signal SIGSEGV</strong> 错误</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">Application received signal SIGSEGV</span><br><span class="line">(null)</span><br><span class="line">(</span><br><span class="line">	<span class="number">0</span>   CoreFoundation                      <span class="number">0</span>x2f28eee3  + <span class="number">154</span></span><br><span class="line">	<span class="number">1</span>   libobjc.A.dylib                     <span class="number">0</span>x39a29ce7 objc_exception_throw + <span class="number">38</span></span><br><span class="line">	<span class="number">2</span>   CoreFoundation                      <span class="number">0</span>x2f28ee0d  + <span class="number">0</span></span><br><span class="line">	<span class="number">3</span>   myAppName                           <span class="number">0</span>x123b59 myAppName + <span class="number">1178457</span></span><br><span class="line">	<span class="number">4</span>   libsystem_platform.dylib            <span class="number">0</span>x3a04171b _sigtramp + <span class="number">34</span></span><br><span class="line">	<span class="number">5</span>   UIKit                               <span class="number">0</span>x31f59ea3  + <span class="number">62</span></span><br><span class="line">	<span class="number">6</span>   UIKit                               <span class="number">0</span>x31<span class="built_in">cd</span>71d7  + <span class="number">94</span></span><br><span class="line">	<span class="number">7</span>   UIKit                               <span class="number">0</span>x31<span class="built_in">cd</span>6edb  + <span class="number">378</span></span><br><span class="line">	<span class="number">8</span>   UIKit                               <span class="number">0</span>x31bde7d3  + <span class="number">1078</span></span><br><span class="line">	<span class="number">9</span>   UIKit                               <span class="number">0</span>x31c90c93  + <span class="number">214</span></span><br><span class="line">	<span class="number">10</span>  UIKit                               <span class="number">0</span>x31b3fde9  + <span class="number">316</span></span><br><span class="line">	<span class="number">11</span>  UIKit                               <span class="number">0</span>x31ab8b37  + <span class="number">430</span></span><br><span class="line">	<span class="number">12</span>  CoreFoundation                      <span class="number">0</span>x2f259ff9  + <span class="number">20</span></span><br><span class="line">	<span class="number">13</span>  CoreFoundation                      <span class="number">0</span>x2f257987  + <span class="number">286</span></span><br><span class="line">	<span class="number">14</span>  CoreFoundation                      <span class="number">0</span>x2f257<span class="built_in">cd</span>3  + <span class="number">738</span></span><br><span class="line">	<span class="number">15</span>  CoreFoundation                      <span class="number">0</span>x2f1c2729 CFRunLoopRunSpecific + <span class="number">524</span></span><br><span class="line">	<span class="number">16</span>  CoreFoundation                      <span class="number">0</span>x2f1c250b CFRunLoopRunInMode + <span class="number">106</span></span><br><span class="line">	<span class="number">17</span>  GraphicsServices                    <span class="number">0</span>x341316d3 GSEventRunModal + <span class="number">138</span></span><br><span class="line">	<span class="number">18</span>  UIKit                               <span class="number">0</span>x31b23871 UIApplicationMain + <span class="number">1136</span></span><br><span class="line">	<span class="number">19</span>  myAppName                           <span class="number">0</span>xb9de7 myAppName + <span class="number">744935</span></span><br><span class="line">	<span class="number">20</span>  libdyld.dylib                       <span class="number">0</span>x39f27ab7  + <span class="number">2</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">dSYM UUID: BD160261-<span class="number">5655</span>-<span class="number">349</span>F-BA5D-<span class="number">9</span>C47FDD88226</span><br><span class="line">CPU Type: armv7</span><br><span class="line">Slide Address: <span class="number">0</span>x00004000</span><br><span class="line">Binary Image: myAppName</span><br><span class="line">Base Address: <span class="number">0</span>x0005b000</span><br></pre></td></tr></table></figure>
<p>此类信息，无明显提示。</p>
<p>使用以下方法，可以得出具体信息</p>
<ol>
<li><p>打开Archive界面，找到上传的历史版本，右键 【show in Finder】</p>
<p> <img src="http://7xo6u7.com1.z0.glb.clouddn.com/oc/oc_18.png" alt="Archive界面"></p>
</li>
<li><p>找到该版本，右键【显示包内容】-&gt;【dYSMs】</p>
<p>将myAppName.app.dSYMs复制到桌面</p>
</li>
<li><p>在终端中输入</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> Desktop</span><br><span class="line"></span><br><span class="line">atos -arch armv7 -o 将myAppName <span class="number">0</span>x5c24d</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>结果输出内存地址编译返回的信息</p>
<p>-[IQKeyboardManager nextAction:] (in myAppName) (IQKeyboardManager.m:1472)</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/友盟统计/">友盟统计</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-相机小窗口" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/04/相机小窗口/" class="article-date">
  	<time datetime="2016-04-08T01:58:25.000Z" itemprop="datePublished">2016-04-08</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/相机小窗口/">相机小窗口</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>在使用 <strong>like</strong> 这个app时，打开相册，会弹出照片列表，左上角第一个却是小小的相机取景框，觉得很奇妙。</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">_picker = [[<span class="built_in">UIImagePickerController</span> alloc] init];</span><br><span class="line"><span class="keyword">if</span>([[[<span class="built_in">UIDevice</span></span><br><span class="line">      currentDevice] systemVersion] floatValue]&gt;=<span class="number">8.0</span>) &#123;</span><br><span class="line">    _picker<span class="variable">.modalPresentationStyle</span> = <span class="built_in">UIModalPresentationOverCurrentContext</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    _picker<span class="variable">.modalPresentationStyle</span> = <span class="built_in">UIModalPresentationFormSheet</span>;</span><br><span class="line">&#125;</span><br><span class="line">_picker<span class="variable">.modalTransitionStyle</span> = <span class="built_in">UIModalTransitionStyleCoverVertical</span>;</span><br><span class="line">_picker<span class="variable">.sourceType</span> = <span class="built_in">UIImagePickerControllerSourceTypeCamera</span>;</span><br><span class="line">_picker<span class="variable">.showsCameraControls</span> = <span class="literal">NO</span>;</span><br><span class="line">[_picker<span class="variable">.view</span> setFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">140</span>, <span class="number">140</span>)];</span><br><span class="line"></span><br><span class="line">[img addSubview:_picker<span class="variable">.view</span>];</span><br></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/相机缩略图/">相机缩略图</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-iOS利用Jenkins搭建自动化编译打包发布" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/iOS利用Jenkins搭建自动化编译打包发布/" class="article-date">
  	<time datetime="2016-03-31T05:46:57.000Z" itemprop="datePublished">2016-03-31</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/iOS利用Jenkins搭建自动化编译打包发布/">iOS利用Jenkins搭建自动化编译打包发布</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>iOS利用Jenkins搭建自动化编译打包发布</p>
<h4 id="u4F7F_u7528_u547D_u4EE4_u884C_u5B89_u88C5Jenkins"><a href="#u4F7F_u7528_u547D_u4EE4_u884C_u5B89_u88C5Jenkins" class="headerlink" title="使用命令行安装Jenkins"></a>使用命令行安装Jenkins</h4><ol>
<li><p>如果没有安装homebrew,先进行安装 (若已安装，则跳过)</p>
<p> 安装homebrew</p>
<pre><code>$ ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;
</code></pre></li>
<li><p>安装Jenkins</p>
<pre><code>$ brew install jenkins 
</code></pre></li>
<li><p>启动Jenkins</p>
<pre><code>$ jenkins
</code></pre></li>
<li><p>测试是否安装成功</p>
<p> 浏览器访问</p>
<pre><code>http://localhost:8080/
</code></pre><p> 如果端口冲突，修改端口</p>
<pre><code>defaults write /Library/Preferences/org.jenkins-ci httpPort xxxx
</code></pre></li>
</ol>
<h4 id="Jenkins_u4F7F_u7528"><a href="#Jenkins_u4F7F_u7528" class="headerlink" title="Jenkins使用"></a>Jenkins使用</h4><ol>
<li><p>安装插件</p>
<p> <img src="http://7xo6u7.com1.z0.glb.clouddn.com/oc/oc_10.png" alt="Jenkins首页图片"></p>
<p> 【系统管理】 -&gt; 【管理插件】 -&gt; 【可选插件】</p>
<p> 安装如下插件</p>
<ul>
<li><p>Xcode integration</p>
</li>
<li><p>GIT plugin</p>
</li>
<li><p>Post-Build Script Plug-in</p>
</li>
<li><p>GitHub plugin</p>
</li>
</ul>
</li>
<li><p>新建项目</p>
<p><img src="http://7xo6u7.com1.z0.glb.clouddn.com/oc/oc_11.png" alt="Jenkins新建项目图片"></p>
<p>【新建】 -&gt; [构建一个自由风格的软件项目] </p>
</li>
<li><p>配置</p>
<ol>
<li><p>填写描述</p>
</li>
<li><p>源码管理</p>
<p><img src="http://7xo6u7.com1.z0.glb.clouddn.com/oc/oc_12.png" alt="Jenkins源码管理"></p>
<p>此处使用的是开源中国git私有仓库，若为public，则无需填写 <em>Credentials</em> </p>
</li>
<li><p>构建触发器（可不设置）</p>
<p><img src="http://7xo6u7.com1.z0.glb.clouddn.com/oc/oc_13.png" alt="Jenkins构建触发器"></p>
<pre><code>H H(10-11) * * 1-5
</code></pre><p>表示在每周一到周五，10点到11点之间构建一次。</p>
</li>
<li><p>构建</p>
<p><img src="http://7xo6u7.com1.z0.glb.clouddn.com/oc/oc_14.png" alt="Jenkins构建General build settings"></p>
<p>设置需要构建的工程target名称，及输出的ipa名称，此处使用分发证书，ad hoc</p>
</li>
<li><p>钥匙串</p>
<p><img src="http://7xo6u7.com1.z0.glb.clouddn.com/oc/oc_15.png" alt="Jenkins钥匙串"></p>
<p>Keychain path :</p>
<pre><code>${HOME}/Library/Keychains/login.keychain
</code></pre></li>
<li><p>使用cocoapods，需要配置此处（否则，可跳过）</p>
<p> <img src="http://7xo6u7.com1.z0.glb.clouddn.com/oc/oc_16.png" alt="Jenkins cocoapods配置"></p>
</li>
<li><p>构建后步骤</p>
<p>上传到fir.im</p>
<p> Build steps  –&gt;  Excecute shell  –&gt;  Command 填入</p>
<pre><code>fir p ${WORKSPACE}/build/DemoJenkins.ipa -T **此处为fir.im API token**
</code></pre></li>
<li><p>保存。 立即构建，去fir.im 查看即可。</p>
<p><img src="http://7xo6u7.com1.z0.glb.clouddn.com/oc/oc_17.png" alt="Jenkins构建历史"></p>
</li>
</ol>
</li>
<li><p>注意：</p>
<p> 在3-7前，首先确认安装fir_cli</p>
<pre><code>sudo gem install fir-cli --no-ri --no-rdoc
</code></pre><p> <a href="https://github.com/FIRHQ/fir-cli/blob/master/README.md" target="_blank" rel="external">fir_cli 官方使用说明</a></p>
<p> 安装</p>
<pre><code>$ gem install fir-cli
</code></pre><p> 登录</p>
<pre><code>fir login **fir.im API token**
</code></pre></li>
</ol>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/Jenkins-iOS-fir-自动化编译打包/">Jenkins_iOS_fir 自动化编译打包</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-记一次对Anyview阅读iOS版wifi传书功能的抹黑探索" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/记一次对Anyview阅读iOS版wifi传书功能的抹黑探索/" class="article-date">
  	<time datetime="2016-03-15T13:57:40.000Z" itemprop="datePublished">2016-03-15</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/记一次对Anyview阅读iOS版wifi传书功能的抹黑探索/">记一次对Anyview阅读iOS版wifi传书功能的抹黑探索</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="u8BB0_u4E00_u6B21_u5BF9Anyview_u9605_u8BFBiOS_u7248wifi_u4F20_u4E66_u529F_u80FD_u7684_u62B9_u9ED1_u63A2_u7D22"><a href="#u8BB0_u4E00_u6B21_u5BF9Anyview_u9605_u8BFBiOS_u7248wifi_u4F20_u4E66_u529F_u80FD_u7684_u62B9_u9ED1_u63A2_u7D22" class="headerlink" title="记一次对Anyview阅读iOS版wifi传书功能的抹黑探索"></a>记一次对Anyview阅读iOS版wifi传书功能的抹黑探索</h4><hr>
<h5 id="u539F_u56E0"><a href="#u539F_u56E0" class="headerlink" title="原因"></a>原因</h5><p>由于我最习惯使用的看小说的软件是 <strong>Anyview 阅读</strong> ，当然也是习惯使然，从塞班时代，到安卓，到iOS，一直如此。</p>
<p>而我习惯于阅读本地书籍，即从网络下载之后，不用网也能看，主要是能一气呵成，看书要停顿，不太好。但是iOS有个不太友好的地方，就是不能随便操作本地文件，当然本着没有条件创造条件也要上的原则，使用wifi传输文件，就成为了一种折中的选择。</p>
<p>对于wifi传书的基本，在上篇博客<a href="http://www.3vcolor.com/2016/03/iOS实现wifi传书功能/">iOS实现wifi传书功能</a>中已经说过了。</p>
<p>但是在真实项目中使用，实在是毫无体验可言。我试着做过，靠着一点前端的基础，基本做了个demo，但实在拿不出手。</p>
<hr>
<h5 id="u8BD5_u9519"><a href="#u8BD5_u9519" class="headerlink" title="试错"></a>试错</h5><ol>
<li><p>从实现获取文件目录开始，使用jquery的ajax get请求，因为要实现删除的功能，所以返回的html中带了一个调用当前js的方法的button，（这个方法确实太傻），但是调用时却不执行，于是返回时将button改成a标签，之后就可以了</p>
</li>
<li><p>最关键的还是文件上传，在之前博客中，是可以文件上传的，但是上传之后，页面跳转，这就太丑了，对于只有几个简单功能来说的服务器来说，体验太差了。</p>
<p>之后找到了一种可以实现ajax上传的方式，<a href="http://zhaoyanblog.com/archives/83.html" target="_blank" rel="external">使用Ajaxupload.js上传文件</a>，但是上传之后成功的回调，却无法调用本地js，替换当前页面的数据，而且不能显示进度条。劣势自然而然。</p>
<p>最后让我想到一个方法，因为iOS app作为服务器，服务器文件只能放在ipa包内，所以一不做二不休，直接拆包，拿到 Anyview阅读 中的web服务器文件，然而拿到是拿到了，枉我还做过pc网站，竟然萌萌哒，看来js还是要多加学习呀。看来修改前端是行不通了，那就另寻他路。</p>
<h5 id="u4ED6_u8DEF"><a href="#u4ED6_u8DEF" class="headerlink" title="他路"></a>他路</h5><p>没那心思去滤清前端的逻辑，那就从中间作为入口，使用 <strong>Charles</strong> 监听接口，根据传过来的数据，处理之后，仿照之前的数据返回不就行了。于是，一切照章进行，除了下载功能，其他均已实现。</p>
</li>
</ol>
<hr>
<p>废话少说，当然是上代码</p>
<p>AnyHTTPConnection.m</p>
<ul>
<li>设置支持的方法</li>
</ul>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">BOOL</span>)supportsMethod:(<span class="built_in">NSString</span> *)method atPath:(<span class="built_in">NSString</span> *)path</span><br><span class="line">&#123;</span><br><span class="line">    HTTPLogTrace();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Add support for POST</span></span><br><span class="line">    <span class="keyword">if</span> ([method isEqualToString:<span class="string">@"POST"</span>])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ([method isEqualToString:<span class="string">@"DELETE"</span>]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ([method isEqualToString:<span class="string">@"GET"</span>]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">super</span> supportsMethod:method atPath:path];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>处理文件上传内容</li>
</ul>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">BOOL</span>)expectsRequestBodyFromMethod:(<span class="built_in">NSString</span> *)method atPath:(<span class="built_in">NSString</span> *)path</span><br><span class="line">&#123;</span><br><span class="line">    HTTPLogTrace();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Inform HTTP server that we expect a body to accompany a POST request</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>([method isEqualToString:<span class="string">@"POST"</span>] &amp;&amp; [path hasPrefix:<span class="string">@"/upload"</span>]) &#123;</span><br><span class="line">        <span class="comment">// here we need to make sure, boundary is set in header</span></span><br><span class="line">        <span class="built_in">NSString</span>* contentType = [request headerField:<span class="string">@"Content-Type"</span>];</span><br><span class="line">        <span class="built_in">NSUInteger</span> paramsSeparator = [contentType rangeOfString:<span class="string">@";"</span>]<span class="variable">.location</span>;</span><br><span class="line">        <span class="keyword">if</span>( <span class="built_in">NSNotFound</span> == paramsSeparator ) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>( paramsSeparator &gt;= contentType<span class="variable">.length</span> - <span class="number">1</span> ) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">NSString</span>* type = [contentType substringToIndex:paramsSeparator];</span><br><span class="line">        <span class="keyword">if</span>( ![type isEqualToString:<span class="string">@"multipart/form-data"</span>] ) &#123;</span><br><span class="line">            <span class="comment">// we expect multipart/form-data content type</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// enumerate all params in content-type, and find boundary there</span></span><br><span class="line">        <span class="built_in">NSArray</span>* params = [[contentType substringFromIndex:paramsSeparator + <span class="number">1</span>] componentsSeparatedByString:<span class="string">@";"</span>];</span><br><span class="line">        <span class="keyword">for</span>( <span class="built_in">NSString</span>* param <span class="keyword">in</span> params ) &#123;</span><br><span class="line">            paramsSeparator = [param rangeOfString:<span class="string">@"="</span>]<span class="variable">.location</span>;</span><br><span class="line">            <span class="keyword">if</span>( (<span class="built_in">NSNotFound</span> == paramsSeparator) || paramsSeparator &gt;= param<span class="variable">.length</span> - <span class="number">1</span> ) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">NSString</span>* paramName = [param substringWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">1</span>, paramsSeparator-<span class="number">1</span>)];</span><br><span class="line">            <span class="built_in">NSString</span>* paramValue = [param substringFromIndex:paramsSeparator+<span class="number">1</span>];</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span>( [paramName isEqualToString: <span class="string">@"boundary"</span>] ) &#123;</span><br><span class="line">                <span class="comment">// let's separate the boundary from content-type, to make it more handy to handle</span></span><br><span class="line">                [request setHeaderField:<span class="string">@"boundary"</span> value:paramValue];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// check if boundary specified</span></span><br><span class="line">        <span class="keyword">if</span>( <span class="literal">nil</span> == [request headerField:<span class="string">@"boundary"</span>] )  &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">super</span> expectsRequestBodyFromMethod:method atPath:path];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>处理body数据</li>
</ul>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)processBodyData:(<span class="built_in">NSData</span> *)postDataChunk</span><br><span class="line">&#123;</span><br><span class="line">    HTTPLogTrace();</span><br><span class="line">    <span class="comment">// append data to the parser. It will invoke callbacks to let us handle</span></span><br><span class="line">    <span class="comment">// parsed data.</span></span><br><span class="line">    [request appendData:postDataChunk];<span class="comment">//post body存储</span></span><br><span class="line">    [parser appendData:postDataChunk];<span class="comment">//文件存储</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>最关键的所在，处理请求</li>
</ul>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSObject</span>&lt;HTTPResponse&gt; *)httpResponseForMethod:(<span class="built_in">NSString</span> *)method URI:(<span class="built_in">NSString</span> *)path</span><br><span class="line">&#123;</span><br><span class="line">    HTTPLogTrace();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//页面初始化时，填充数据</span></span><br><span class="line">    <span class="keyword">if</span> ([path isEqualToString:<span class="string">@"/index.html"</span>] || [path isEqualToString:<span class="string">@"/"</span>] || [path hasPrefix:<span class="string">@"/index.html"</span>]) &#123;</span><br><span class="line">        <span class="built_in">NSString</span>* templatePath = [[config documentRoot] stringByAppendingPathComponent:<span class="string">@"index.html"</span>];</span><br><span class="line">        <span class="built_in">NSMutableDictionary</span> *replacementDict = [<span class="built_in">NSMutableDictionary</span> dictionary];</span><br><span class="line">        [replacementDict setObject:<span class="string">@"Wifi传书"</span> forKey:<span class="string">@"title"</span>];</span><br><span class="line">        [replacementDict setObject:<span class="string">@"iOS"</span> forKey:<span class="string">@"device"</span>];</span><br><span class="line">        [replacementDict setObject:<span class="string">@"XFReader"</span> forKey:<span class="string">@"header"</span>];</span><br><span class="line">        [replacementDict setObject:<span class="string">@"拖拽文件到窗口或者点击“上传书籍”按钮选择您要上传的书籍，上传完成后就可以在书架上看到您上传的书啦，赶紧上传吧！"</span> forKey:<span class="string">@"prologue"</span>];</span><br><span class="line">        [replacementDict setObject:<span class="string">@""</span> forKey:<span class="string">@"epilogue"</span>];</span><br><span class="line">        [replacementDict setObject:<span class="string">@"XFReader 1.0.0"</span> forKey:<span class="string">@"footer"</span>];</span><br><span class="line">        <span class="keyword">return</span> [[HTTPDynamicFileResponse alloc] initWithFilePath:templatePath forConnection:<span class="keyword">self</span> separator:<span class="string">@"%"</span> replacementDictionary:replacementDict];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//表单数据，返回NSString类型json数据[&#123;"name":"1.txt","path":"/upload/1.txt","size":"12400"&#125;,&#123;"name":"2.txt","path":"/upload/2.txt","size":"15000"&#125;]</span></span><br><span class="line">    <span class="keyword">if</span> ([path hasPrefix:<span class="string">@"/list?path="</span>] &amp;&amp; [method isEqualToString:<span class="string">@"GET"</span>]) &#123;</span><br><span class="line">        <span class="built_in">NSData</span> *response = [<span class="keyword">self</span> dictToData:[<span class="keyword">self</span> filesInfoList]];</span><br><span class="line">        <span class="keyword">return</span> [[HTTPDataResponse alloc] initWithData:response];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//下载 返回 文件内容</span></span><br><span class="line">    <span class="keyword">if</span> ([path hasPrefix:<span class="string">@"/download?path="</span>] &amp;&amp; [method isEqualToString:<span class="string">@"GET"</span>]) &#123;</span><br><span class="line">        <span class="comment">//获取body内容</span></span><br><span class="line">        <span class="built_in">NSArray</span> *tArr = [[path stringByRemovingPercentEncoding] componentsSeparatedByString:<span class="string">@"="</span>];</span><br><span class="line">        <span class="keyword">if</span> (tArr<span class="variable">.count</span> &gt;= <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="comment">//返回文件数据</span></span><br><span class="line">            <span class="comment">//NSData *data = [NSData dataWithContentsOfFile:[self filePath:tArr[1]] options:(NSDataReadingUncached) error:nil];</span></span><br><span class="line">            <span class="comment">//return [[HTTPDataResponse alloc] initWithData:data];</span></span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//参数错误</span></span><br><span class="line">            <span class="built_in">NSData</span> *response = [<span class="string">@"参数错误"</span> dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line">            <span class="keyword">return</span> [[HTTPDataResponse alloc] initWithData:response];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//删除 根据路径删除文件</span></span><br><span class="line">    <span class="keyword">if</span> ([path hasPrefix:<span class="string">@"/delete"</span>] &amp;&amp; [method isEqualToString:<span class="string">@"POST"</span>]) &#123;</span><br><span class="line">        <span class="built_in">NSString</span> *body = [[<span class="built_in">NSString</span> alloc] initWithData:request<span class="variable">.body</span> encoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line">        <span class="built_in">NSArray</span> *tArr = [[body stringByRemovingPercentEncoding] componentsSeparatedByString:<span class="string">@"="</span>];</span><br><span class="line">        <span class="keyword">if</span> (tArr<span class="variable">.count</span> &gt;= <span class="number">2</span>) &#123;</span><br><span class="line">            [<span class="keyword">self</span> deleteFile:tArr[<span class="number">1</span>]];<span class="comment">//删除文件</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">NSData</span> *response = [<span class="string">@"&#123;&#125;"</span> dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line">        <span class="keyword">return</span> [[HTTPDataResponse alloc] initWithData:response];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//上传文件</span></span><br><span class="line">    <span class="keyword">if</span> ([path hasPrefix:<span class="string">@"/upload"</span>] &amp;&amp; [method isEqualToString:<span class="string">@"POST"</span>]) &#123;</span><br><span class="line">        [<span class="keyword">self</span> moveFiles:uploadedFiles];</span><br><span class="line">        <span class="built_in">NSData</span> *response = [<span class="string">@"&#123;&#125;"</span> dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line">        <span class="keyword">return</span> [[HTTPDataResponse alloc] initWithData:response];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//重命名 根据新旧路径 修改文件名 oldPath=/upload/1.txt&amp;newPath=/upload/2.txt</span></span><br><span class="line">    <span class="keyword">if</span> ([path hasPrefix:<span class="string">@"/move"</span>] &amp;&amp; [method isEqualToString:<span class="string">@"POST"</span>]) &#123;</span><br><span class="line">        <span class="comment">//oldPath, newPath</span></span><br><span class="line">        <span class="built_in">NSString</span> *body = [[[<span class="built_in">NSString</span> alloc] initWithData:request<span class="variable">.body</span> encoding:<span class="built_in">NSUTF8StringEncoding</span>] stringByRemovingPercentEncoding];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"body = %@"</span>,body);</span><br><span class="line">        <span class="built_in">NSArray</span> *arr = [body componentsSeparatedByString:<span class="string">@"&amp;"</span>];<span class="comment">//oldPath=/upload/1.txt</span></span><br><span class="line">        <span class="built_in">NSArray</span> *tA0 = [arr[<span class="number">0</span>] componentsSeparatedByString:<span class="string">@"="</span>];<span class="comment">//olodPath  /upload/1.txt</span></span><br><span class="line">        <span class="built_in">NSArray</span> *tA1 = [arr[<span class="number">1</span>] componentsSeparatedByString:<span class="string">@"="</span>];</span><br><span class="line">        <span class="built_in">NSString</span> *oldPath = <span class="string">@""</span>;</span><br><span class="line">        <span class="built_in">NSString</span> *newPath = <span class="string">@""</span>;</span><br><span class="line">        <span class="keyword">if</span> ([tA0[<span class="number">0</span>] isEqualToString:<span class="string">@"oldPath"</span>]) &#123;</span><br><span class="line">            oldPath = tA0[<span class="number">1</span>];</span><br><span class="line">            newPath = tA1[<span class="number">1</span>];</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            oldPath = tA1[<span class="number">1</span>];</span><br><span class="line">            newPath = tA0[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        [<span class="keyword">self</span> renameFile:oldPath newPath:newPath];</span><br><span class="line">        <span class="built_in">NSData</span> *response = [<span class="string">@"&#123;&#125;"</span> dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line">        <span class="keyword">return</span> [[HTTPDataResponse alloc] initWithData:response];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">super</span> httpResponseForMethod:method URI:path];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/记一次对Anyview阅读iOS版wifi传书功能的抹黑探索/">记一次对Anyview阅读iOS版wifi传书功能的抹黑探索</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-iosversion" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/iosversion/" class="article-date">
  	<time datetime="2016-03-10T01:47:14.000Z" itemprop="datePublished">2016-03-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/iosversion/">iOSversion</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>获取iOS当前版本</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *version = [[[<span class="built_in">NSBundle</span> mainBundle] infoDictionary] objectForKey:<span class="string">@"CFBundleShortVersionString"</span>];</span><br></pre></td></tr></table></figure>
<p>判断版本高低<br><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ([version compare:<span class="string">@"2.0.14"</span> options:<span class="built_in">NSNumericSearch</span>] ==<span class="built_in">NSOrderedDescending</span> ) &#123;<span class="comment">//比较系统版本</span></span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"当前版本较高"</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>  &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"当前版本较低"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/iOS-version/">iOS version</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-枚举类型导致的1 duplicate symbol for architecture x86_64错误" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/枚举类型导致的1 duplicate symbol for architecture x86_64错误/" class="article-date">
  	<time datetime="2016-03-06T09:18:36.000Z" itemprop="datePublished">2016-03-06</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/枚举类型导致的1 duplicate symbol for architecture x86_64错误/">枚举类型导致的1 duplicate symbol for architecture x86_64错误</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h5 id="bug_u8D77_u56E0_28ios7-1_uFF0CxCode7-2-1_29"><a href="#bug_u8D77_u56E0_28ios7-1_uFF0CxCode7-2-1_29" class="headerlink" title="bug起因(ios7.1，xCode7.2.1)"></a>bug起因(ios7.1，xCode7.2.1)</h5><p>工程原本是正常运行的（不管模拟器还是真机）</p>
<p>但是之后添加了新的Target - WatchKit App 之后，真机运行正常，模拟器运行报错</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">duplicate symbol _iToastDuration <span class="keyword">in</span>:</span><br><span class="line">    /Users/and/Library/Developer/Xcode/DerivedData/MyCircle-fdzonquheuzvvzaqxjtrlbpililv/Build/Intermediates/MyCircle.build/Debug-iphonesimulator/MyCircle.build/Objects-normal/x86_64/BaseViewController.o</span><br><span class="line">    /Users/and/Library/Developer/Xcode/DerivedData/MyCircle-fdzonquheuzvvzaqxjtrlbpililv/Build/Products/Debug-iphonesimulator/libiToast.a(iToast.o)</span><br><span class="line">ld: <span class="number">1</span> duplicate symbol <span class="keyword">for</span> architecture x86_64</span><br><span class="line">clang: error: linker <span class="built_in">command</span> failed with <span class="built_in">exit</span> code <span class="number">1</span> (use -v to see invocation)</span><br></pre></td></tr></table></figure>
<p>在百度、谷歌，修改了一系列Search Frame Path之后，仍是一无所获。</p>
<p>之后找到了参看了 <a href="http://www.jianshu.com/p/2b79e450d67e" target="_blank" rel="external"> <em>枚举类型导致的1 duplicate symbol for architecture x86_64错误</em> </a> ，去到iToast源码中找到以下代码</p>
<blockquote>
<p>p.s. Podfile中支持ios7.1，从pod上更新所得的iToast为0.0.1，代码如下</p>
<p>而直接从 <a href="https://github.com/ecstasy2/toast-notifications-ios" target="_blank" rel="external">github</a> 下载的iToast.h中则不缺少typedef</p>
</blockquote>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> iToastGravity &#123;</span><br><span class="line">	iToastGravityTop = <span class="number">1000001</span>,</span><br><span class="line">	iToastGravityBottom,</span><br><span class="line">	iToastGravityCenter</span><br><span class="line">&#125;iToastGravity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> iToastDuration &#123;</span><br><span class="line">	iToastDurationLong = <span class="number">10000</span>,</span><br><span class="line">	iToastDurationShort = <span class="number">1000</span>,</span><br><span class="line">	iToastDurationNormal = <span class="number">3000</span></span><br><span class="line">&#125;iToastDuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> iToastType &#123;</span><br><span class="line">	iToastTypeInfo = -<span class="number">100000</span>,</span><br><span class="line">	iToastTypeNotice,</span><br><span class="line">	iToastTypeWarning,</span><br><span class="line">	iToastTypeError,</span><br><span class="line">	iToastTypeNone <span class="comment">// For internal use only (to force no image)</span></span><br><span class="line">&#125;iToastType;</span><br></pre></td></tr></table></figure>
<p>一共三个枚举，不知道为何只有 <em>iToastDuration</em> 用了C语言样式的枚举。</p>
<p>由于iToast引用于pod，于是改用本地引用，</p>
<blockquote>
<p>直接从github上down下的文件，直接使用。</p>
<p>因为iToast用于MRC，ARC下使用在Target-Build Phases-Compile Source中iToast.m 添加 <strong>-fno-objc-arc</strong></p>
</blockquote>
<p>解决。</p>
<p></p><h4>本文参考</h4><p></p>
<h5 id="u7B80_u4E66__u7531_u4E8E_u679A_u4E3E_u7C7B_u578B_u5BFC_u81F4_u76841_duplicate_symbol_for_architecture_x86_64_u9519_u8BEF"><a href="#u7B80_u4E66__u7531_u4E8E_u679A_u4E3E_u7C7B_u578B_u5BFC_u81F4_u76841_duplicate_symbol_for_architecture_x86_64_u9519_u8BEF" class="headerlink" title="简书 由于枚举类型导致的1 duplicate symbol for architecture x86_64错误"></a><a href="http://www.jianshu.com/p/2b79e450d67e" target="_blank" rel="external">简书 <em>由于枚举类型导致的1 duplicate symbol for architecture x86_64错误</em> </a></h5><h5 id="iToast_github_u5730_u5740"><a href="#iToast_github_u5730_u5740" class="headerlink" title="iToast github地址"></a><a href="https://github.com/ecstasy2/toast-notifications-ios" target="_blank" rel="external">iToast github地址</a></h5><hr>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bug/">bug</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/iOS-1-duplicate-symbol-for-architecture-x86-64错误/">iOS 1 duplicate symbol for architecture x86_64错误</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-iOS实现wifi传书功能" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/iOS实现wifi传书功能/" class="article-date">
  	<time datetime="2016-03-04T09:54:52.000Z" itemprop="datePublished">2016-03-04</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/iOS实现wifi传书功能/">iOS实现wifi传书功能</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>由于iOS的封闭性，没有像安卓一样的便利的文件管理器（当然也是iOS安全的一个表现），每个app都有自己独立的操作空间，也叫沙盒。</p>
</blockquote>
<p> <strong>Anyview阅读</strong> 是从塞班时代一直用到现在的，由于大多小说是从网络下载的txt文本文件，需要从电脑转存到手机上，而又由于iOS的诸多限制，所以就用到了此阅读器的wifi传书的功能。</p>
<h5 id="u539F_u7406_uFF1A"><a href="#u539F_u7406_uFF1A" class="headerlink" title="原理："></a>原理：</h5><p>将手机作为服务器，在同一网络下，可以通过浏览器访问到此服务器，上传文件后，服务器（即手机）将文件存储到沙盒内。</p>
<h5 id="u4F7F_u7528_uFF1A"><a href="#u4F7F_u7528_uFF1A" class="headerlink" title="使用："></a>使用：</h5><p><a href="/1"><strong>CocoaHTTPServer</strong></a> 是面向Mac OS X和iOS app的轻量级、可嵌入的HTTP服务器框架。</p>
<h5 id="u53C2_u8003_uFF1A"><a href="#u53C2_u8003_uFF1A" class="headerlink" title="参考："></a>参考：</h5><p><a href="http://blog.csdn.net/wjsxiaoweige/article/details/25902293" target="_blank" rel="external">cocoahttpserver使用详解（一）</a></p>
<p><a href="http://www.oschina.net/code/snippet_569983_11316#18460" target="_blank" rel="external">ajax 文件上传</a></p>
<h5 id="u6B65_u9AA4_uFF1A"><a href="#u6B65_u9AA4_uFF1A" class="headerlink" title="步骤："></a>步骤：</h5><ol>
<li>导入库文件<ul>
<li>Security.framework</li>
<li>CFNetwork.framework</li>
</ul>
</li>
<li><p>将CocoaHTTPServer中的类拖入工程</p>
<p> <img src="http://7xo6u7.com1.z0.glb.clouddn.com/oc/oc_2.png" alt="cocoaHttpServer拖入工程"></p>
</li>
<li><p>将web文件夹拖入工程(注意：此处文件夹为蓝色，为真实目录，【打开ipa包】-【显示包内容】，可以看到该文件夹所有内容)</p>
<p> <img src="http://7xo6u7.com1.z0.glb.clouddn.com/oc/oc_3.png" alt="web文件夹目录"></p>
</li>
<li><p>在AppDelegate.h中声明httpServer</p>
 <figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#import <span class="title">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">HTTPServer</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">AppDelegate</span> : <span class="title">UIResponder</span>&lt;<span class="title">UIApplicationDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">UIWindow</span> *window;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) HTTPServer *httpServer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在AppDelegate.m中启动和关闭服务器（当然真正在项目中使用时，也可以放在VC中）</p>
<p> 引用头文件</p>
 <figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#import <span class="title">"HTTPServer.h"</span></span></span><br><span class="line"><span class="preprocessor">#import <span class="title">"DDLog.h"</span></span></span><br><span class="line"><span class="preprocessor">#import <span class="title">"DDTTYLogger.h"</span></span></span><br><span class="line"><span class="preprocessor">#import <span class="title">"MyHTTPConnection.h"</span></span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> ddLogLevel = LOG_LEVEL_VERBOSE;</span><br></pre></td></tr></table></figure>
<p> 初始化httpServer</p>
 <figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">	- (<span class="keyword">void</span>)setServer &#123;</span><br><span class="line">    [DDLog addLogger:[DDTTYLogger sharedInstance]];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span><span class="variable">.httpServer</span> = [[HTTPServer alloc] init];<span class="comment">//初始化</span></span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span><span class="variable">.httpServer</span> setType:<span class="string">@"_http._tcp."</span>];<span class="comment">//通过Bonjour服务发布的类型,允许浏览器访问</span></span><br><span class="line">    [<span class="keyword">self</span><span class="variable">.httpServer</span> setPort:<span class="number">8080</span>];<span class="comment">//设置端口</span></span><br><span class="line">    <span class="comment">//[self.httpServer setConnectionClass:[MyHTTPConnection class]];//设置处理连接的自定义类文件</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSString</span> *webPath = [[[<span class="built_in">NSBundle</span> mainBundle] resourcePath] stringByAppendingPathComponent:<span class="string">@"Web"</span>];</span><br><span class="line">    DDLogInfo(<span class="string">@"Setting document root: %@"</span>, webPath);</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span><span class="variable">.httpServer</span> setDocumentRoot:webPath];<span class="comment">//设置服务器根目录</span></span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"home = %@"</span>,<span class="built_in">NSHomeDirectory</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 开启httpServer</p>
 <figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">	- (<span class="keyword">void</span>)startServer</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Start the server (and check for problems)</span></span><br><span class="line">    <span class="built_in">NSError</span> *error;</span><br><span class="line">    <span class="keyword">if</span>([<span class="keyword">self</span><span class="variable">.httpServer</span> start:&amp;error])&#123;</span><br><span class="line">        DDLogInfo(<span class="string">@"Started HTTP Server on port %hu %@"</span>, [<span class="keyword">self</span><span class="variable">.httpServer</span> listeningPort],<span class="keyword">self</span><span class="variable">.httpServer</span><span class="variable">.domain</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        DDLogError(<span class="string">@"Error starting HTTP Server: %@"</span>, error);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 此时通过手机【设置】-【无线局域网】-【当前连接的无线网】-【IP地址】，例如IP地址为192.168.2.2，之前设置的端口为8080，则在同一wifi下的电脑浏览器访问 <a href="http://192.168.2.2:8080" target="_blank" rel="external">http://192.168.2.2:8080</a> 即可访问到web目录下的index.html，到此已经说明服务器搭建好了。</p>
<p> 然而使用中让用户去寻找IP地址还是比较麻烦的，所以直接将地址显示在app中就相当有人性了。</p>
<ol>
<li><p>在vc中引入头文件</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#include <span class="title">&lt;ifaddrs.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#include <span class="title">&lt;arpa/inet.h&gt;</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>获取本机ip地址</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSString</span> *)deviceIPAdress &#123;</span><br><span class="line">  	<span class="built_in">NSString</span> *address = <span class="string">@"an error occurred when obtaining ip address"</span>;</span><br><span class="line">   <span class="keyword">struct</span> ifaddrs *interfaces = <span class="literal">NULL</span>;</span><br><span class="line">   <span class="keyword">struct</span> ifaddrs *temp_addr = <span class="literal">NULL</span>;</span><br><span class="line">   <span class="keyword">int</span> success = <span class="number">0</span>;</span><br><span class="line">   success = getifaddrs(&amp;interfaces);</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">if</span> (success == <span class="number">0</span>) &#123; <span class="comment">// 0 表示获取成功</span></span><br><span class="line">       </span><br><span class="line">       temp_addr = interfaces;</span><br><span class="line">       <span class="keyword">while</span> (temp_addr != <span class="literal">NULL</span>) &#123;</span><br><span class="line">           <span class="keyword">if</span>( temp_addr-&gt;ifa_addr-&gt;sa_family == AF_INET) &#123;</span><br><span class="line">               <span class="comment">// Check if interface is en0 which is the wifi connection on the iPhone</span></span><br><span class="line">               <span class="keyword">if</span> ([[<span class="built_in">NSString</span> stringWithUTF8String:temp_addr-&gt;ifa_name] isEqualToString:<span class="string">@"en0"</span>]) &#123;</span><br><span class="line">                   <span class="comment">// Get NSString from C String</span></span><br><span class="line">                   address = [<span class="built_in">NSString</span> stringWithUTF8String:inet_ntoa(((<span class="keyword">struct</span> sockaddr_in *)temp_addr-&gt;ifa_addr)-&gt;sin_addr)];</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">           </span><br><span class="line">           temp_addr = temp_addr-&gt;ifa_next;</span><br><span class="line">       &#125;</span><br><span class="line">   	&#125;</span><br><span class="line">   </span><br><span class="line">   	freeifaddrs(interfaces);</span><br><span class="line">   </span><br><span class="line">   	<span class="built_in">NSLog</span>(<span class="string">@"手机的IP是：%@"</span>, address);</span><br><span class="line">   	<span class="keyword">return</span> address;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加一个label到vc上，用来显示服务器地址</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UILabel</span> *label = [[<span class="built_in">UILabel</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="keyword">self</span><span class="variable">.view</span><span class="variable">.frame</span><span class="variable">.size</span><span class="variable">.width</span>, <span class="number">50</span>)];</span><br><span class="line">    label<span class="variable">.text</span> = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"http://%@:%@"</span>, [<span class="keyword">self</span> deviceIPAdress],<span class="string">@"8080"</span>];</span><br><span class="line">    label<span class="variable">.textAlignment</span> = <span class="built_in">NSTextAlignmentCenter</span>;</span><br><span class="line">    [<span class="keyword">self</span><span class="variable">.view</span> addSubview:label];</span><br><span class="line">    label<span class="variable">.center</span> = <span class="keyword">self</span><span class="variable">.view</span><span class="variable">.center</span>;</span><br></pre></td></tr></table></figure>
<p>现在运行工程，app中就会显示服务器地址，不需要再查看手机设置了。</p>
</li>
</ol>
</li>
<li><p>之后就是传书，由于手机作为服务器，很明显不能使用php或者jsp了，那就只能使用HTTPConnection方法来处理。</p>
<ol>
<li>web服务器html，使用的<a href="http://www.oschina.net/code/snippet_569983_11316#18460" target="_blank" rel="external">使用ajax+html上传文件</a>，部分有改动。</li>
<li><p>在html页面中，可以使用一下格式 <strong>%a%</strong> 占位，之后数据可由自定义的HTTPConnection填充。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"filesname"</span>&gt;</span>%filesname%<span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>使用自定义的<a href="/2">MyHTTPConnectioin(见Demo)</a>，继承与HTTPConnection，来处理上传的文件。在此仅说明部分方法</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">	- (<span class="built_in">NSObject</span>&lt;HTTPResponse&gt; *)httpResponseForMethod:(<span class="built_in">NSString</span> *)method URI:(<span class="built_in">NSString</span> *)path</span><br><span class="line">&#123;</span><br><span class="line">    HTTPLogTrace();</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> ([method isEqualToString:<span class="string">@"POST"</span>] &amp;&amp; [path isEqualToString:<span class="string">@"/upload.html"</span>])</span><br><span class="line">    &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// this method will generate response with links to uploaded file</span></span><br><span class="line">        <span class="built_in">NSMutableString</span>* filesStr = [[<span class="built_in">NSMutableString</span> alloc] init];</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>( <span class="built_in">NSString</span>* filePath <span class="keyword">in</span> uploadedFiles ) &#123;</span><br><span class="line">            <span class="comment">//generate links</span></span><br><span class="line">            [filesStr appendFormat:<span class="string">@"&lt;a href=\"%@\"&gt; %@ &lt;/a&gt;&lt;br/&gt;"</span>,filePath, [filePath lastPathComponent]];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">NSString</span>* templatePath = [[config documentRoot] stringByAppendingPathComponent:<span class="string">@"upload.html"</span>];</span><br><span class="line">        <span class="built_in">NSDictionary</span>* replacementDict = [<span class="built_in">NSDictionary</span> dictionaryWithObject:filesStr forKey:<span class="string">@"MyFiles"</span>];</span><br><span class="line">        <span class="comment">// use dynamic file response to apply our links to response template</span></span><br><span class="line">        <span class="keyword">return</span> [[HTTPDynamicFileResponse alloc] initWithFilePath:templatePath forConnection:<span class="keyword">self</span> separator:<span class="string">@"%"</span> replacementDictionary:replacementDict];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>( [method isEqualToString:<span class="string">@"GET"</span>] &amp;&amp; [path hasPrefix:<span class="string">@"/upload/"</span>] ) &#123;</span><br><span class="line">        <span class="comment">// let download the uploaded files</span></span><br><span class="line">        <span class="keyword">return</span> [[HTTPFileResponse alloc] initWithFilePath: [[config documentRoot] stringByAppendingString:path] forConnection:<span class="keyword">self</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> ([path isEqualToString:<span class="string">@"/index.html"</span>] || [path isEqualToString:<span class="string">@"/"</span>]) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">NSString</span>* templatePath = [[config documentRoot] stringByAppendingPathComponent:<span class="string">@"index.html"</span>];</span><br><span class="line">        <span class="comment">//NSDictionary* replacementDict = [NSDictionary dictionaryWithObject:@"哈哈" forKey:@"ceshi"];</span></span><br><span class="line">        <span class="built_in">NSMutableDictionary</span> *replacementDict = [<span class="built_in">NSMutableDictionary</span> dictionary];</span><br><span class="line">        </span><br><span class="line">        [replacementDict setObject:<span class="string">@"哈哈"</span> forKey:<span class="string">@"ceshi"</span>];</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">NSFileManager</span> *fileManager = [<span class="built_in">NSFileManager</span> defaultManager];</span><br><span class="line">        <span class="comment">//在这里获取应用程序Documents文件夹里的文件及文件夹列表</span></span><br><span class="line">        <span class="built_in">NSArray</span> *documentPaths = <span class="built_in">NSSearchPathForDirectoriesInDomains</span>(<span class="built_in">NSDocumentDirectory</span>, <span class="built_in">NSUserDomainMask</span>, <span class="literal">YES</span>);</span><br><span class="line">        <span class="built_in">NSString</span> *documentDir = [documentPaths objectAtIndex:<span class="number">0</span>];</span><br><span class="line">        <span class="built_in">NSError</span> *error = <span class="literal">nil</span>;</span><br><span class="line">        <span class="built_in">NSArray</span> *fileList = [[<span class="built_in">NSArray</span> alloc] init];</span><br><span class="line">        <span class="comment">//fileList便是包含有该文件夹下所有文件的文件名及文件夹名的数组</span></span><br><span class="line">        fileList = [fileManager contentsOfDirectoryAtPath:documentDir error:&amp;error];</span><br><span class="line">        <span class="built_in">NSString</span> *uploadFile = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@/upload"</span>,documentDir];</span><br><span class="line"><span class="comment">//        if (![fileList containsObject:@"upload"]) &#123;//不存在则新建文件夹</span></span><br><span class="line"><span class="comment">//            [fileManager createDirectoryAtPath:uploadFile attributes:nil];</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line">        <span class="built_in">NSArray</span> *upA = [fileManager directoryContentsAtPath:uploadFile];</span><br><span class="line">        <span class="built_in">NSMutableString</span> *st = [<span class="built_in">NSMutableString</span> string];</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">NSString</span> *ul <span class="keyword">in</span> upA) &#123;</span><br><span class="line">            [st appendString:ul];</span><br><span class="line">        &#125;</span><br><span class="line">        [replacementDict setObject:st forKey:<span class="string">@"filess"</span>];</span><br><span class="line">        <span class="comment">// use dynamic file response to apply our links to response template</span></span><br><span class="line">        <span class="keyword">return</span> [[HTTPDynamicFileResponse alloc] initWithFilePath:templatePath forConnection:<span class="keyword">self</span> separator:<span class="string">@"%"</span> replacementDictionary:replacementDict];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">super</span> httpResponseForMethod:method URI:path];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>本方法可以作为在页面初始化时，作为补位工作。<br> 将setServer方法中</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="keyword">self</span><span class="variable">.httpServer</span> setConnectionClass:[MyHTTPConnection class]];<span class="comment">//设置处理连接的自定义类文件</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>解除注释，再次运行，上传文件后，可以看到upload文件夹下的所有文件名全部显示了，在此也可以写通知刷新app界面。当然就看需求是什么样的了。</p>
</li>
</ol>
</li>
</ol>
<p><a href="https://import.github.com/xiaozhangfei/WifiUpload" target="_blank" rel="external">本文github地址</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/iOS-wifi传书/">iOS wifi传书</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 三维色
    	</div>

        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
 <span id="busuanzi_container_site_uv"  align="center">
  本站访客数<span id="busuanzi_value_site_uv"></span>人次
</span>

      	<div class="footer-right">
         
      		<a href="http://www.3vcolor.com" target="_blank">一只小小的程序猿</a>
      	</div>
         
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>


<!--  -->



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>